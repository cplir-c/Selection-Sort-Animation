<html>
    <head>
        <link rel="stylesheet"
            href='data:text/css,#flex-container{
                display:flex;
                align-items:center;
                justify-content:center;
                min-width:5vw;
                min-height:5vh;
                padding:1vw 1vh;
                background-color:lightblue;
                border:1vw dodgerblue;
                border-style:ridge inset inset ridge;
                border-radius:5vw;
            }
            #flex-container>div{
                background-color:skyblue;
                border-color:blue;
                border-width:1vh;
                border-radius:1.5vh;
                border-style:solid;
                min-width:1vw;
                min-height:1vh;
                padding:1vw 1vh;
                margin:2vw 2vh;
                top:0vh;
                left:0vw;
                transition:top 500ms,left 500ms;
                -o-transition:top 500ms,left 500ms;
                -webkit-transition:top 500ms,left 500ms;
                -moz-transition:top 500ms,left 500ms;
                transition-timing-function:ease;
                position:relative;
            }
            #flex-container>div.target{
                top:50vh;
            }
            #flex-container>div.target::after{
                content:" (Target)";
            }
            #flex-container>div.smallest{
                top:45vh;
            }
            #flex-container>div.smallest::after{
                content:" (Smallest)";
            }
            #flex-container>div.potential{
                top:40vh;
            }'>
        <script>
            function animateSort(){
                let list=document.getElementById("flex-container");
                list.style["background-color"]="lightblue";
                list.removeAttribute("onclick");
                function* generator(){
                    for(let targetIndex=0;targetIndex<list.children.length;targetIndex++){
                        list.children[targetIndex].setAttribute('class',"target");
                        yield this;
                        let smallestIndex=targetIndex;
                        
                        for(let potentialSmallestIndex=smallestIndex+1;potentialSmallestIndex<list.children.length;potentialSmallestIndex++){
                            list.children[potentialSmallestIndex].setAttribute('class',list.children[potentialSmallestIndex].getAttribute('class')+" potential");
                            yield this;
                            if(+list.children[potentialSmallestIndex].textContent<+list.children[smallestIndex].textContent){
                                list.children[smallestIndex].setAttribute('class',list.children[smallestIndex].getAttribute('class').replace(/ ?smallest/g,""));
                                smallestIndex=potentialSmallestIndex;
                                list.children[smallestIndex].setAttribute('class',list.children[smallestIndex].getAttribute('class').replace(/ ?potential/g,"")+" smallest");
                                yield this;
                            } else {
                                list.children[potentialSmallestIndex].setAttribute('class',list.children[smallestIndex].getAttribute('class').replace(/ ?potential/g,""));
                            } 
                            yield this;
                        }
                        if(+list.children[smallestIndex].textContent<+list.children[targetIndex].textContent){
                            //smallest is smallest so swap with target
                            //swapping is the only sideways animation
                            let distance=((-list.children[targetIndex].getBoundingClientRect().left)+(+list.children[smallestIndex].getBoundingClientRect().left))
                            list.children[smallestIndex].style.left=-distance+"px";
                            list.children[targetIndex].style.left=distance+"px";
                            yield this;
                            yield this;
                            let clone=list.children[targetIndex].cloneNode(true);
                            let target=list.replaceChild(clone,list.children[targetIndex]);//replace target with a clone
                            //replace smallest with target
                            list.replaceChild(list.replaceChild(target,list.children[smallestIndex]),clone);
                            //replace clone with smallest
                            //skip glitched animation
                            let previous=list.children[targetIndex].style["transition-duration"];
                            list.children[targetIndex].style.transitionDuration="0.005ms";
                            list.children[smallestIndex].style.transitionDuration="0.005ms";
                            list.children[smallestIndex].style.left="0vw";
                            list.children[targetIndex].style.left="0vw";
                            list.children[targetIndex].style.transitionDuration=previous;
                            list.children[smallestIndex].style.transitionDuration=previous;
                            yield this;
                            yield this;
                        } else {
                            //just let the target go back to the array, it is smallest
                        }
                        list.children[targetIndex].setAttribute('class','');
                        list.children[smallestIndex].setAttribute("class","");
                        yield this;
                    }
                    animating=false;//let it start again; it's done
                }
                if(animating==undefined||animating==null||animating==""){//if it can call a next don't start another animation
                    let iterator=generator()
                    var animating=true;
                    list.addEventListener("transitionend",function(){iterator.next();});//this way yielding waits for the transition to end and then continues
                    document.children[0].addEventListener("click",function(){iterator.next();});
                    iterator.next()//start the animation
                    //every yield is moved past by a an ending transition.
                }
            }
            function refreshList(){
                let data=[3,1, 7, 9, 2, 6];
                let list=document.getElementById("flex-container");
                list.innerHTML="";
                list.style["background-color"]="aqua";
                list.addEventListener("click",function(){return animateSort();});
                for(let number of data){
                    let div=document.createElement("div");
                    div.textContent=number;
                    list.appendChild(div);
                }
            }
            document.children[0].addEventListener("loadend",function(){refreshList();});
            document.children[0].addEventListener("loadend",function(){animateSort();});
        </script>
    </head>
    <body>
        <div id='flex-container' onclick="refreshList();animateSort();">
            Click to advance.
            <div onclick="animateSort();">
            </div>
        </div>
    </body>
</html>
